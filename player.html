<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ÌÅ¥Î¶¨Ïª§ Í≤åÏûÑ</title>
  <style>
    body {
      font-family: "Pretendard", sans-serif;
      text-align: center;
      margin-top: 60px;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      color: #333;
      transition: background 0.5s ease;
    }
    body.boost { background: linear-gradient(135deg, #ffeaa7, #fab1a0); }
    body.super { background: linear-gradient(135deg, #fff176, #ffca28); animation: glow 1s infinite alternate; }
    @keyframes glow { 0% { filter: brightness(1); } 100% { filter: brightness(1.2); } }

    h1 { font-size: 2.5rem; margin-bottom: 20px; }

    button {
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.25s;
    }
    button:hover { transform: scale(1.05); }

    .click-btn {
      background: #ff7675;
      color: white;
      box-shadow: 0 0 10px rgba(255, 118, 117, 0.6);
      transition: background 0.3s, box-shadow 0.3s;
    }
    .click-btn.double {
      background: linear-gradient(45deg, #f9ca24, #f0932b);
      box-shadow: 0 0 20px rgba(255, 204, 0, 0.9);
      animation: pulse 1s infinite;
    }
    @keyframes pulse { 0% { box-shadow: 0 0 10px rgba(255, 204, 0, 0.5); } 50% { box-shadow: 0 0 20px rgba(255, 204, 0, 1); } 100% { box-shadow: 0 0 10px rgba(255, 204, 0, 0.5); } }
    .click-btn.sparkle { position: relative; overflow: hidden; }
    .click-btn.sparkle::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 70%);
      animation: sparkle 1.5s infinite linear;
    }
    @keyframes sparkle { 0% { transform: translate(0,0) rotate(0deg); } 100% { transform: translate(50%,50%) rotate(360deg); } }

    .stop-btn { background: #636e72; color: white; }
    .shop-btn { background: #0984e3; color: white; }

    .shop {
      display: none;
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 20px;
      width: 360px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    .shop h3 { margin-bottom: 15px; }
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .item p { margin: 0; font-weight: 500; }
    .buy-btn {
      background: #00b894;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
    }
    .buy-btn:disabled { background: #b2bec3; cursor: default; }

    .auto-glow { animation: autoClickGlow 1s infinite alternate; }
    @keyframes autoClickGlow { 0% { box-shadow: 0 0 5px rgba(0,255,100,0.4); } 100% { box-shadow: 0 0 20px rgba(0,255,100,0.9); } }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, get, set, update, push } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA5V5sZy8AeeurQMSXo-iQgkaDdXN3ecio",
      authDomain: "clicker-dc943.firebaseapp.com",
      databaseURL: "https://clicker-dc943-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "clicker-dc943",
      storageBucket: "clicker-dc943.firebasestorage.app",
      messagingSenderId: "529125125957",
      appId: "1:529125125957:web:44771a9e3a40dc3847d82c",
      measurementId: "G-T5QJBBDYW9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let nickname = "";
    let count = 0;
    let points = 0;
    let startTime = null;
    let timerInterval = null;
    let boostActive = false;
    let superActive = false;
    let upgrades = {};

    const shopItems = {
      autoclick: { name: "ÏûêÎèô ÌÅ¥Î¶≠Í∏∞", prices: [500, 1000, 1500] },
      doubleClick: { name: "2Î∞∞ ÌÅ¥Î¶≠ Í∞ïÌôî", prices: [500, 1500, 3000] },
      boost10s: { name: "10Ï¥à Î≤ÑÌîÑ", prices: [100, 300, 500] },
      superBoost: { name: "30Ï¥à ÏäàÌçºÎ≤ÑÌîÑ", prices: [1000, 3000, 5000] },
      sparkleTheme: { name: "Î∞òÏßù ÌÖåÎßà", prices: [500, 1000, 2000] }
    };

    window.startGame = async function() {
      nickname = document.getElementById('nickname').value.trim();
      if(!nickname) return alert('ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');

      document.getElementById('login').style.display = 'none';
      document.getElementById('game').style.display = 'block';
      count = 0;
      document.getElementById('count').innerText = count;
      startTime = Date.now();
      document.getElementById('timer').innerText = '00:00';
      timerInterval = setInterval(updateTimer, 250);

      await loadUserData();
      applyUpgrades();
    };

    function formatTime(ms) {
      const s = Math.floor(ms / 1000);
      const mm = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      return `${mm}:${ss}`;
    }

    function updateTimer() {
      if(!startTime) return;
      document.getElementById('timer').innerText = formatTime(Date.now()-startTime);
    }

    async function loadUserData() {
      const userRef = ref(db, `users/${nickname}`);
      const snapshot = await get(userRef);
      if(snapshot.exists()){
        const data = snapshot.val();
        points = data.points || 0;
        upgrades = data.upgrades || {};
      } else {
        let initialUpgrades = {};
        Object.keys(shopItems).forEach(k => initialUpgrades[k] = 0);
        await set(userRef, { points:0, upgrades:initialUpgrades });
        points = 0;
        upgrades = initialUpgrades;
      }
      updatePointDisplay();
    }

    function updatePointDisplay() {
      document.getElementById('points').innerText = points;
    }

    window.clickButton = function() {
      let gain = 1;
      if(boostActive) gain *= 3;
      if(superActive) gain *= 2;
      if(upgrades.doubleClick >= 1) gain *= (1 + upgrades.doubleClick);
      count += gain;
      points += gain;
      document.getElementById('points').innerText = points;
      document.getElementById('count').innerText = count;
    };

    window.stopGame = async function() {
      if(!startTime) return;
      const durationMs = Date.now() - startTime;
      try{
        await push(ref(db,'plays'), { nickname, clicks: count, durationMs, timestamp: Date.now() });
        await update(ref(db,`users/${nickname}`), { points, upgrades });
        document.getElementById('status').innerText='Í∏∞Î°ùÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§. Í∞êÏÇ¨Ìï©ÎãàÎã§!';
        document.getElementById('status').style.color='green';
      } catch(e){
        console.error(e);
        document.getElementById('status').innerText='Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
        document.getElementById('status').style.color='red';
      }
      clearInterval(timerInterval);
      startTime=null;
      boostActive=false;
      superActive=false;
      document.body.classList.remove("boost","super");
      document.getElementById('game').style.display='none';
      document.getElementById('login').style.display='block';
    };

    window.toggleShop = function() {
      const shop = document.getElementById('shop');
      shop.style.display = shop.style.display==='none'?'block':'none';
      renderShop();
    };

    async function renderShop() {
      const shopContainer = document.getElementById('shopItems');
      shopContainer.innerHTML='';
      Object.keys(shopItems).forEach(key=>{
        const item = shopItems[key];
        const level = upgrades[key] || 0;
        const isBuff = (key==="boost10s" || key==="superBoost");
        const nextPrice = item.prices[level >= item.prices.length ? item.prices.length-1 : level];
        const boughtMax = (!isBuff && level >= item.prices.length);
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `<p>${item.name} ${!isBuff?"Lv."+level:""} ${boughtMax?"(ÏµúÎåÄ)":"- "+nextPrice+"Ìè¨Ïù∏Ìä∏"}</p>
                         <button class="buy-btn" ${boughtMax?"disabled":""} onclick="buyItem('${key}')">Íµ¨Îß§</button>`;
        shopContainer.appendChild(div);
      });
    }

    window.buyItem = async function(itemKey) {
      const item = shopItems[itemKey];
      const level = upgrades[itemKey] || 0;
      const isBuff = (itemKey==="boost10s" || itemKey==="superBoost");
      const price = item.prices[level >= item.prices.length ? item.prices.length-1 : level];

      if(points < price) return alert("Ìè¨Ïù∏Ìä∏Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!");
      points -= price;

      if(isBuff){
        activateBuff(itemKey==="boost10s"?"boost":"super", itemKey==="boost10s"?10000:30000);
      } else {
        upgrades[itemKey] += 1;
      }

      await set(ref(db, `users/${nickname}`), { points, upgrades });
      updatePointDisplay();
      renderShop();
      applyUpgrades();
      alert(`${item.name}ÏùÑ(Î•º) ${isBuff?"ÏÇ¨Ïö©":"Lv."+upgrades[itemKey]}ÌñàÏäµÎãàÎã§!`);
    };

    function applyUpgrades() {
      const clickBtn = document.querySelector('.click-btn');
      clickBtn.classList.remove("auto-glow","double","sparkle");

      if(upgrades.autoclick>=1){
        clickBtn.classList.add('auto-glow');
        clearInterval(window.autoclickInterval);
        window.autoclickInterval = setInterval(()=>clickButton(),1000/(1+upgrades.autoclick-1));
      }
      if(upgrades.doubleClick>=1) clickBtn.classList.add('double');
      if(upgrades.sparkleTheme>=1) clickBtn.classList.add('sparkle');
    }

    function activateBuff(type, duration){
      if((type==="boost" && boostActive)||(type==="super" && superActive))
        return alert("Ïù¥ÎØ∏ Î≤ÑÌîÑÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§!");
      if(type==="boost") boostActive=true;
      if(type==="super") superActive=true;
      document.body.classList.add(type);
      setTimeout(()=>{
        if(type==="boost") boostActive=false;
        if(type==="super") superActive=false;
        document.body.classList.remove(type);
      }, duration);
    }
  </script>
</head>

<body>
  <h1>üî• ÌÅ¥Î¶≠ Í≤åÏûÑ üî•</h1>
  <div id="login">
    <input id="nickname" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•" />
    <button onclick="startGame()">ÏãúÏûë</button>
  </div>

  <div id="game" style="display:none;">
    <p>‚≠ê Ìè¨Ïù∏Ìä∏: <span id="points">0</span></p>
    <h2>ÌÅ¥Î¶≠ Ïàò: <span id="count">0</span></h2>
    <p>‚è± <span id="timer">00:00</span></p>
    <button class="click-btn" onclick="clickButton()">ÌÅ¥Î¶≠!</button>
    <button class="stop-btn" onclick="stopGame()">Ï¢ÖÎ£å</button>
    <button class="shop-btn" onclick="toggleShop()">ÏÉÅÏ†ê</button>
    <p id="status"></p>
  </div>

  <div id="shop" class="shop">
    <h3>üõí ÏÉÅÏ†ê</h3>
    <div id="shopItems"></div>
  </div>
</body>
</html>




