<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í´ë¦¬ì»¤ ê²Œì„</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    // ğŸ”¹ Firebase ì„¤ì • (ë‹¹ì‹  í”„ë¡œì íŠ¸ ì •ë³´)
    const firebaseConfig = {
      apiKey: "AIzaSyA5V5sZy8AeeurQMSXo-iQgkaDdXN3ecio",
      authDomain: "clicker-dc943.firebaseapp.com",
      databaseURL: "https://clicker-dc943-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "clicker-dc943",
      storageBucket: "clicker-dc943.firebasestorage.app",
      messagingSenderId: "529125125957",
      appId: "1:529125125957:web:44771a9e3a40dc3847d82c",
      measurementId: "G-T5QJBBDYW9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ğŸ”¹ í´ë¦­ ê²Œì„ ë¡œì§
    let count = 0;
    let startTime = null;
    let timerInterval = null;

    function formatTime(ms) {
      const s = Math.floor(ms / 1000);
      const mm = String(Math.floor(s / 60)).padStart(2, '0');
      const ss = String(s % 60).padStart(2, '0');
      return `${mm}:${ss}`;
    }

    function updateTimer() {
      if (!startTime) return;
      document.getElementById('timer').innerText = formatTime(Date.now() - startTime);
    }

    window.startGame = function () {
      const nick = document.getElementById('nickname').value.trim();
      if (!nick) {
        alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      document.getElementById('login').style.display = 'none';
      document.getElementById('game').style.display = 'block';
      count = 0;
      document.getElementById('count').innerText = count;
      startTime = Date.now();
      document.getElementById('timer').innerText = '00:00';
      timerInterval = setInterval(updateTimer, 250);
    }

    window.clickButton = function () {
      count++;
      document.getElementById('count').innerText = count;
    }

    window.stopGame = async function () {
      if (!startTime) return;
      const nickname = document.getElementById('nickname').value.trim();
      const durationMs = Date.now() - startTime;

      try {
        const playsRef = ref(db, 'plays');
        await push(playsRef, {
          nickname: nickname,
          clicks: count,
          durationMs: durationMs,
          timestamp: Date.now()
        });
        document.getElementById('status').innerText = 'ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!';
        document.getElementById('status').style.color = 'green';
      } catch (e) {
        console.error(e);
        document.getElementById('status').innerText = 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        document.getElementById('status').style.color = 'red';
      }

      clearInterval(timerInterval);
      startTime = null;
      document.getElementById('game').style.display = 'none';
      document.getElementById('login').style.display = 'block';
    }
  </script>
</head>

<body style="font-family: sans-serif; text-align: center; margin-top: 60px;">
  <h1>ğŸ”¥ í´ë¦­ ê²Œì„ ğŸ”¥</h1>

  <div id="login">
    <input id="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" />
    <button onclick="startGame()">ì‹œì‘</button>
  </div>

  <div id="game" style="display:none;">
    <p>â± <span id="timer">00:00</span></p>
    <h2>í´ë¦­ ìˆ˜: <span id="count">0</span></h2>
    <button onclick="clickButton()">í´ë¦­!</button>
    <button onclick="stopGame()">ì¢…ë£Œ</button>
    <p id="status"></p>
  </div>
</body>
</html>
