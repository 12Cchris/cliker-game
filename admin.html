<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clicker Game 관리자</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    table { margin: 20px auto; border-collapse: collapse; width: 80%; max-width: 600px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
    #dataDiv { display: none; }
  </style>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA5V5sZy8AeeurQMSXo-iQgkaDdXN3ecio",
      authDomain: "clicker-dc943.firebaseapp.com",
      databaseURL: "https://clicker-dc943-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "clicker-dc943",
      storageBucket: "clicker-dc943.firebasestorage.app",
      messagingSenderId: "529125125957",
      appId: "1:529125125957:web:44771a9e3a40dc3847d82c",
      measurementId: "G-T5QJBBDYW9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const passDiv = document.createElement("div");
    const passInput = document.createElement("input");
    passInput.type = "password";
    passInput.placeholder = "관리자 비밀번호";
    const passBtn = document.createElement("button");
    passBtn.textContent = "확인";
    const status = document.createElement("div");
    const dataDiv = document.createElement("div");
    dataDiv.id = "dataDiv";

    document.body.append(passDiv, status, dataDiv);
    passDiv.append(passInput, passBtn);

    // 관리자 비밀번호 확인
    passBtn.addEventListener("click", async () => {
      const inputPass = passInput.value.trim();
      if (!inputPass) return alert("비밀번호를 입력하세요.");
      status.innerText = "확인 중...";

      try {
        const snapshot = await get(child(ref(db), "admin/password"));
        const realPass = snapshot.exists() ? snapshot.val() : null;
        if (realPass && inputPass === realPass) {
          status.style.color = "green";
          status.innerText = "접속 성공!";
          passDiv.style.display = "none";
          dataDiv.style.display = "block";
          loadData();
        } else {
          status.style.color = "red";
          status.innerText = "비밀번호가 틀렸습니다.";
        }
      } catch (err) {
        console.error(err);
        status.innerText = "오류 발생";
      }
    });

    // 기록 불러오기
    async function loadData() {
      const table = document.createElement("table");
      table.innerHTML = `
        <tr>
          <th>닉네임</th>
          <th>클릭 수</th>
          <th>플레이 시간</th>
          <th>저장 시각</th>
        </tr>
      `;

      try {
        const snapshot = await get(child(ref(db), "plays"));
        if (snapshot.exists()) {
          const data = snapshot.val();
          const rows = Object.values(data).sort((a, b) => b.timestamp - a.timestamp);
          for (const row of rows) {
            const tr = document.createElement("tr");
            const durationSec = Math.floor(row.durationMs / 1000);
            const min = String(Math.floor(durationSec / 60)).padStart(2, "0");
            const sec = String(durationSec % 60).padStart(2, "0");
            const time = `${min}:${sec}`;
            const date = new Date(row.timestamp).toLocaleString("ko-KR");
            tr.innerHTML = `
              <td>${row.nickname}</td>
              <td>${row.clicks}</td>
              <td>${time}</td>
              <td>${date}</td>
            `;
            table.appendChild(tr);
          }
          dataDiv.append(table);
        } else {
          dataDiv.innerText = "저장된 기록이 없습니다.";
        }
      } catch (err) {
        console.error(err);
        dataDiv.innerText = "데이터 불러오기 실패.";
      }
    }
  </script>
</head>
<body>
</body>
</html>
